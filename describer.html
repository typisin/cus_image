<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Advanced AI Image Describer tool that automatically generates accurate, natural language descriptions for any image with multilingual captioning capabilities">
    <meta name="keywords" content="image describer, AI image captioning, automatic image description, AI image analyzer, image to text, smart image description">
    <title>AI Image Describer - Automatic Image Captioning & Description Tool | CusImage</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="brand">
                <div class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <rect x="3" y="4" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 13l3-3 5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="8" cy="9" r="1.5" fill="currentColor"/>
                    </svg>
                </div>
                <h1 class="title">CusImage</h1>
                <p class="subtitle">Advanced AI Image Describer & Editing Solutions</p>
            </div>
            <div class="nav-dropdown">
                <button class="nav-toggle" aria-haspopup="true" aria-expanded="false" aria-controls="main-nav">Menu</button>
                <nav class="nav" id="main-nav" aria-label="Main navigation">
                    <ul class="nav-menu">
                        <li><a href="/describer.html" class="nav-link" aria-current="page">Image Describer</a></li>
                        <li><a href="/cutout.html" class="nav-link">AI Cutout</a></li>
                        <li><a href="/unicode.html" class="nav-link">Image to Unicode</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <section class="hero">
                <h2 class="hero-title">AI-Powered Image Describer</h2>
                <p class="hero-description">Upload any image and get accurate, natural language descriptions automatically generated by our advanced AI image describer technology</p>
            </section>

            <div class="describer-card" role="region" aria-label="Image describer">
                <div class="describer-header">
                    <label for="file" class="describer-label">Upload image</label>
                    <div class="file-input-container">
                        <input id="file" type="file" accept="image/*" class="describer-input" />
                        <div class="file-input-button" id="fileButton">
                            <div class="file-input-text">
                                <span class="svg-icon medium">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2L12 22M2 12L22 12"/>
                                    </svg>
                                </span>
                                <span id="fileText">Choose File</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="describer-grid">
                    <div class="describer-section">
                        <div class="describer-section-title">Preview</div>
                        <div class="describer-preview">
                            <img id="preview" alt="Image preview for AI description analysis" />
                            <div id="placeholder" class="describer-placeholder">
                            <span class="svg-icon large">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <rect x="3" y="3" width="18" height="14" rx="2"/>
                                    <path d="M8 13l3-3 5 5"/>
                                    <circle cx="8" cy="9" r="1.5" fill="currentColor"/>
                                </svg>
                            </span>
                            <div>No image selected</div>
                        </div>
                            <div class="describer-loading"></div>
                        </div>
                    </div>

                    <div class="describer-section">
                        <div class="describer-section-title">Description</div>
                        <div id="desc" class="describer-description">
                            <span class="svg-icon large" style="color: var(--gray-400); margin-bottom: var(--space-2);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M12 2L12 22M2 12L22 12"/>
                                </svg>
                            </span>
                            <div style="color: var(--gray-500); font-style: italic;">Upload an image to generate description</div>
                        </div>
                        <div class="describer-actions">
                            <button id="copy" class="describer-btn describer-btn-primary">Copy</button>
                            <button id="reset" class="describer-btn describer-btn-secondary">Reset</button>
                        </div>
                    </div>
                </div>
                <canvas id="canvas" style="display:none;"></canvas>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 CusImage. Smart image editing.</p>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var toggle = document.querySelector('.nav-toggle');
        var dropdown = toggle && toggle.parentElement;
        var nav = dropdown && dropdown.querySelector('.nav');
        if (toggle && dropdown && nav) {
            toggle.addEventListener('click', function() {
                var open = dropdown.classList.toggle('open');
                toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
            });
            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('open');
                    toggle.setAttribute('aria-expanded', 'false');
                }
            });
        }

        var file = document.getElementById('file');
        var fileButton = document.getElementById('fileButton');
        var fileText = document.getElementById('fileText');
        var img = document.getElementById('preview');
        var placeholder = document.getElementById('placeholder');
        var desc = document.getElementById('desc');
        var canvas = document.getElementById('canvas');
        var copyBtn = document.getElementById('copy');
        var resetBtn = document.getElementById('reset');

        // 文件输入按钮交互
        if (file && fileButton && fileText) {
            fileButton.addEventListener('click', function() {
                file.click();
            });

            file.addEventListener('change', function(e) {
                var fileName = e.target.files[0]?.name || 'Choose File';
                fileText.textContent = fileName.length > 20 ? fileName.substring(0, 20) + '...' : fileName;
                fileButton.classList.toggle('has-file', e.target.files.length > 0);
            });
        }

        function rgbToHsl(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            var max = Math.max(r,g,b), min = Math.min(r,g,b);
            var h, s, l = (max + min) / 2;
            if (max === min) { h = 0; s = 0; }
            else {
                var d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h = h * 60;
            }
            return { h: h, s: s, l: l };
        }

        function hueToName(h, s, l) {
            if (s < 0.2) {
                if (l < 0.25) return 'black';
                if (l > 0.75) return 'white';
                return 'gray';
            }
            if (h < 15 || h >= 345) return 'red';
            if (h < 45) return 'orange';
            if (h < 75) return 'yellow';
            if (h < 165) return 'green';
            if (h < 195) return 'cyan';
            if (h < 255) return 'blue';
            if (h < 285) return 'purple';
            if (h < 330) return 'magenta';
            return 'pink';
        }

        function analyze(imgEl) {
            var w = imgEl.naturalWidth;
            var h = imgEl.naturalHeight;
            var maxSide = 256;
            var scale = Math.min(1, maxSide / Math.max(w, h));
            var cw = Math.max(1, Math.floor(w * scale));
            var ch = Math.max(1, Math.floor(h * scale));
            canvas.width = cw;
            canvas.height = ch;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(imgEl, 0, 0, cw, ch);
            var data = ctx.getImageData(0, 0, cw, ch).data;
            var colorCounts = {};
            var total = 0;
            var sumLuma = 0;
            var sumR = 0, sumG = 0, sumB = 0;
            var sumR2 = 0, sumG2 = 0, sumB2 = 0;
            for (var y = 0; y < ch; y += 2) {
                for (var x = 0; x < cw; x += 2) {
                    var i = (y * cw + x) * 4;
                    var r = data[i], g = data[i+1], b = data[i+2];
                    var hsl = rgbToHsl(r,g,b);
                    var name = hueToName(hsl.h, hsl.s, hsl.l);
                    colorCounts[name] = (colorCounts[name] || 0) + 1;
                    total++;
                    var luma = 0.2126 * r + 0.7152 * g + 0.0722 * b;
                    sumLuma += luma;
                    sumR += r; sumG += g; sumB += b;
                    sumR2 += r*r; sumG2 += g*g; sumB2 += b*b;
                }
            }
            var avgLuma = sumLuma / total / 255;
            var meanR = sumR / total, meanG = sumG / total, meanB = sumB / total;
            var varR = sumR2 / total - meanR*meanR;
            var varG = sumG2 / total - meanG*meanG;
            var varB = sumB2 / total - meanB*meanB;
            var colorfulness = Math.sqrt(Math.max(0, varR) + Math.max(0, varG) + Math.max(0, varB)) / 255;

            var gradSum = 0; var gradCount = 0;
            for (var y2 = 1; y2 < ch-1; y2 += 2) {
                for (var x2 = 1; x2 < cw-1; x2 += 2) {
                    var i2 = (y2 * cw + x2) * 4;
                    var gx = ((data[i2+4]||0) - (data[i2-4]||0)) + (((data[i2+4*cw]||0) - (data[i2-4*cw]||0)) * 0.5);
                    var gy = ((data[i2+4*cw]||0) - (data[i2-4*cw]||0)) + (((data[i2+4]||0) - (data[i2-4]||0)) * 0.5);
                    var gmag = Math.sqrt(gx*gx + gy*gy);
                    gradSum += gmag;
                    gradCount++;
                }
            }
            var edgeDensity = gradSum / gradCount / 255;

            var entries = Object.keys(colorCounts).map(function(k){ return { name: k, count: colorCounts[k] }; });
            entries.sort(function(a,b){ return b.count - a.count; });
            var topColors = entries.filter(function(e){ return e.name !== 'gray' && e.name !== 'white' && e.name !== 'black'; }).slice(0,2);
            if (topColors.length === 0) topColors = entries.slice(0,1);
            var tones = topColors.map(function(e){ return e.name; }).join(' and ');

            var bright;
            if (avgLuma < 0.35) bright = 'dark'; else if (avgLuma > 0.65) bright = 'bright'; else bright = 'neutral';
            var vivid;
            if (colorfulness < 0.12) vivid = 'low colorfulness'; else if (colorfulness > 0.28) vivid = 'high colorfulness'; else vivid = 'moderate colorfulness';
            var detail;
            if (edgeDensity < 0.08) detail = 'low detail'; else if (edgeDensity > 0.20) detail = 'rich detail'; else detail = 'medium detail';

            var parts = [];
            parts.push('A photo of size ' + w + '×' + h + '.');
            if (tones) parts.push('Dominant tones: ' + tones + '.');
            parts.push('Overall it looks ' + bright + ' with ' + vivid + ' and ' + detail + '.');
            return parts.join(' ');
        }

        function reset() {
            img.style.display = 'none';
            img.removeAttribute('src');
            placeholder.style.display = 'block';
            desc.textContent = '';
            file.value = '';
        }

        file.addEventListener('change', function(e){
            var f = e.target.files && e.target.files[0];
            if (!f) return;
            var reader = new FileReader();
            reader.onload = function(){
                img.src = reader.result;
                img.onload = function(){
                    placeholder.style.display = 'none';
                    img.style.display = 'block';
                    var d = analyze(img);
                    desc.textContent = d;
                };
            };
            reader.readAsDataURL(f);
        });

        copyBtn.addEventListener('click', function(){
            var text = desc.textContent || '';
            if (!text) return;
            navigator.clipboard && navigator.clipboard.writeText(text).then(function(){}, function(){})
        });

        resetBtn.addEventListener('click', function(){
            reset();
        });
    });
    </script>
</body>
</html>